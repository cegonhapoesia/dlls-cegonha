<html>
<head>
<meta charset="utf-8">
<title>HTA Pentest Toolkit</title>
<HTA:APPLICATION
  ID="oHTA"
  APPLICATIONNAME="HTAPentest"
  BORDER="thin"
  CAPTION="yes"
  SHOWINTASKBAR="yes"
  SINGLEINSTANCE="yes"
  SYSMENU="yes"
/>
<style>
  body { font-family: Arial, sans-serif; margin: 10px; }
  textarea { width: 100%; height: 200px; font-family: monospace; margin-top: 5px; }
  input[type=text], select, textarea { padding: 5px; margin-top: 5px; }
  button { padding: 5px 10px; margin-top: 5px; }
  .section { border: 1px solid #ccc; padding: 10px; margin-top: 10px; }
  label { display: block; margin-top: 10px; }
</style>
<script language="VBScript">
Sub btnScrape_OnClick()
    Dim url, http, html
    url = document.getElementById("txtUrl").value
    If url = "" Then
        MsgBox "Por favor, insira uma URL válida.", vbExclamation, "Erro"
        Exit Sub
    End If

    Set http = CreateObject("MSXML2.XMLHTTP")
    On Error Resume Next
    http.Open "GET", url, False
    http.Send
    If Err.Number <> 0 Then
        MsgBox "Erro ao acessar a URL: " & Err.Description, vbCritical, "Erro"
        Exit Sub
    End If
    On Error GoTo 0

    html = http.responseText
    document.getElementById("txtResult").value = html
    ' Mostrar cabeçalhos
    Dim headers, i
    headers = ""
    For i = 0 To http.getAllResponseHeaders.Count - 1
        headers = headers & http.getAllResponseHeaders & vbCrLf
    Next
    document.getElementById("txtHeaders").value = http.getAllResponseHeaders
End Sub

Sub btnPing_OnClick()
    Dim ip, shell, exec, output, line
    ip = document.getElementById("txtPingIp").value
    If ip = "" Then
        MsgBox "Por favor, insira um IP ou hostname para ping.", vbExclamation, "Erro"
        Exit Sub
    End If
    Set shell = CreateObject("WScript.Shell")
    Set exec = shell.Exec("ping -n 4 " & ip)
    output = ""
    Do While Not exec.StdOut.AtEndOfStream
        line = exec.StdOut.ReadLine()
        output = output & line & vbCrLf
    Loop
    document.getElementById("txtPingResult").value = output
End Sub

Sub btnTcpTest_OnClick()
    Dim host, port, socket, result
    host = document.getElementById("txtTcpHost").value
    port = CInt(document.getElementById("txtTcpPort").value)
    If host = "" Or port = 0 Then
        MsgBox "Por favor, insira host e porta válidos.", vbExclamation, "Erro"
        Exit Sub
    End If
    On Error Resume Next
    Set socket = CreateObject("MSWinsock.Winsock")
    socket.RemoteHost = host
    socket.RemotePort = port
    socket.Connect
    WScript.Sleep 2000 ' espera 2 segundos
    If socket.Connected Then
        result = "Conexão bem-sucedida em " & host & ":" & port
        socket.Close
    Else
        result = "Falha na conexão em " & host & ":" & port
    End If
    On Error GoTo 0
    document.getElementById("txtTcpResult").value = result
End Sub

Sub btnHttpRequest_OnClick()
    Dim url, method, data, http, response
    url = document.getElementById("txtHttpUrl").value
    method = document.getElementById("selHttpMethod").value
    data = document.getElementById("txtHttpData").value

    If url = "" Then
        MsgBox "Por favor, insira uma URL válida.", vbExclamation, "Erro"
        Exit Sub
    End If

    Set http = CreateObject("MSXML2.XMLHTTP")
    On Error Resume Next
    http.Open method, url, False
    If method = "POST" Then
        http.setRequestHeader "Content-Type", "application/x-www-form-urlencoded"
        http.Send data
    Else
        http.Send
    End If
    If Err.Number <> 0 Then
        MsgBox "Erro na requisição HTTP: " & Err.Description, vbCritical, "Erro"
        Exit Sub
    End If
    On Error GoTo 0

    response = "Status: " & http.Status & " " & http.statusText & vbCrLf & _
               "Headers:" & vbCrLf & http.getAllResponseHeaders & vbCrLf & _
               "Body:" & vbCrLf & http.responseText
    document.getElementById("txtHttpResult").value = response
End Sub

Sub btnSaveResult_OnClick()
    Dim fso, filePath, content
    filePath = document.getElementById("txtSavePath").value
    content = document.getElementById("txtResult").value
    If filePath = "" Then
        MsgBox "Por favor, insira o caminho do arquivo para salvar.", vbExclamation, "Erro"
        Exit Sub
    End If
    Set fso = CreateObject("Scripting.FileSystemObject")
    On Error Resume Next
    Dim file
    Set file = fso.CreateTextFile(filePath, True)
    file.Write content
    file.Close
    If Err.Number <> 0 Then
        MsgBox "Erro ao salvar arquivo: " & Err.Description, vbCritical, "Erro"
        Exit Sub
    End If
    On Error GoTo 0
    MsgBox "Arquivo salvo com sucesso em " & filePath, vbInformation, "Sucesso"
End Sub

Sub btnRunCmd_OnClick()
    Dim cmd, shell, exec, output, line
    cmd = document.getElementById("txtCmd").value
    If cmd = "" Then
        MsgBox "Por favor, insira um comando para executar.", vbExclamation, "Erro"
        Exit Sub
    End If
    If MsgBox("Executar comando: " & cmd & " ?", vbYesNo + vbQuestion, "Confirmação") = vbNo Then Exit Sub
    Set shell = CreateObject("WScript.Shell")
    Set exec = shell.Exec("cmd /c " & cmd)
    output = ""
    Do While Not exec.StdOut.AtEndOfStream
        line = exec.StdOut.ReadLine()
        output = output & line & vbCrLf
    Loop
    document.getElementById("txtCmdResult").value = output
End Sub
</script>
<body>
<h1>HTA Pentest Toolkit</h1>

<div class="section">
  <h3>1. Raspagem de HTML</h3>
  <input type="text" id="txtUrl" placeholder="https://exemplo.com" />
  <button id="btnScrape" onclick="btnScrape_OnClick">Raspar HTML</button><br/>
  <label>HTML Raspado:</label>
  <textarea id="txtResult" readonly></textarea>
  <label>Headers HTTP:</label>
  <textarea id="txtHeaders" readonly></textarea>
  <label>Salvar resultado em arquivo:</label>
  <input type="text" id="txtSavePath" placeholder="C:\caminho\arquivo.html" />
  <button onclick="btnSaveResult_OnClick">Salvar</button>
</div>

<div class="section">
  <h3>2. Ping</h3>
  <input type="text" id="txtPingIp" placeholder="IP ou hostname" />
  <button onclick="btnPing_OnClick">Ping</button><br/>
  <textarea id="txtPingResult" readonly></textarea>
</div>

<div class="section">
  <h3>3. Teste de Conexão TCP</h3>
  <input type="text" id="txtTcpHost" placeholder="Host" />
  <input type="text" id="txtTcpPort" placeholder="Porta" style="width: 60px;" />
  <button onclick="btnTcpTest_OnClick">Testar</button><br/>
  <textarea id="txtTcpResult" readonly></textarea>
</div>

<div class="section">
  <h3>4. Requisição HTTP Customizada</h3>
  <input type="text" id="txtHttpUrl" placeholder="URL" style="width: 60%;" />
  <select id="selHttpMethod">
    <option>GET</option>
    <option>POST</option>
  </select><br/>
  <label>Dados para POST (form-urlencoded):</label>
  <textarea id="txtHttpData" style="height: 60px;"></textarea><br/>
  <button onclick="btnHttpRequest_OnClick">Enviar Requisição</button><br/>
  <textarea id="txtHttpResult" readonly style="height: 150px;"></textarea>
</div>

<div class="section">
  <h3>5. Execução de Comandos do Sistema</h3>
  <input type="text" id="txtCmd" placeholder="Comando (ex: ipconfig)" style="width: 60%;" />
  <button onclick="btnRunCmd_OnClick">Executar</button><br/>
  <textarea id="txtCmdResult" readonly style="height: 150px;"></textarea>
</div>

</body>
</html>
